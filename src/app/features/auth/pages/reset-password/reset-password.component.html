<div class="auth-container">
  <div class="auth-content">
    <!-- Government Branding -->
    <div class="branding" @fadeInDown>
      <img
        src="assets/images/nepal-government-logo.png"
        alt="Government Logo"
        class="gov-logo"
      />
      <h1 class="gov-title">{{ "branding.govName" }}</h1>
      <h2 class="system-name-np">{{ "branding.systemName" }}</h2>
    </div>

    <!-- Main Card -->
    <mat-card class="auth-card" [class.loading]="loading" @fadeIn>
      <mat-card-content>
        <!-- Success State -->
        <div class="success-message" *ngIf="resetSuccess" @successState>
          <div class="success-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <h2>{{ "auth.resetPassword.successTitle" }}</h2>
          <p>{{ "auth.resetPassword.successMessage" }}</p>
          <div class="action-buttons">
            <button mat-raised-button color="primary" routerLink="/auth/login">
              <mat-icon>login</mat-icon>
              {{ "auth.resetPassword.proceedToLogin" }}
            </button>
          </div>
        </div>

        <!-- Reset Password Form -->
        <form
          *ngIf="!resetSuccess"
          [formGroup]="resetPasswordForm"
          (ngSubmit)="onSubmit()"
          class="reset-form"
        >
          <div class="form-header">
            <h2>{{ "auth.resetPassword.title" }}</h2>
            <p>{{ "auth.resetPassword.subtitle" }}</p>
          </div>

          <!-- Password Field -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>{{ "auth.resetPassword.newPassword" }}</mat-label>
            <input
              matInput
              formControlName="password"
              [type]="hidePassword ? 'password' : 'text'"
              placeholder="{{ 'auth.resetPassword.enterNewPassword' }}"
            />
            <mat-icon matPrefix>lock_reset</mat-icon>
            <button
              mat-icon-button
              matSuffix
              (click)="hidePassword = !hidePassword"
              [attr.aria-label]="'auth.common.togglePassword'"
              type="button"
            >
              <mat-icon>{{
                hidePassword ? "visibility_off" : "visibility"
              }}</mat-icon>
            </button>
            <mat-error
              *ngIf="resetPasswordForm.get('password')?.hasError('required')"
            >
              {{ "validation.password.required" }}
            </mat-error>
            <mat-error
              *ngIf="resetPasswordForm.get('password')?.hasError('pattern')"
            >
              {{ "validation.password.pattern" }}
            </mat-error>
            <mat-error *ngFor="let error of getValidationErrors()">
              {{ error }}
            </mat-error>
          </mat-form-field>

          <!-- Password Strength Indicator -->
          <div
            class="password-strength"
            *ngIf="resetPasswordForm.get('password')?.value"
          >
            <div class="strength-text">
              {{ "auth.resetPassword.passwordStrength" }}:
              <span [style.color]="getPasswordStrength().color">
                {{ getPasswordStrength().text }}
              </span>
            </div>
            <mat-progress-bar
              [color]="
                getPasswordStrength().color === 'var(--error-color)'
                  ? 'warn'
                  : 'primary'
              "
              [value]="currentStrength"
              class="strength-bar"
            >
            </mat-progress-bar>
            <div
              class="strength-requirements"
              *ngIf="getValidationErrors().length > 0"
            >
              <ul>
                <li *ngFor="let error of getValidationErrors()">
                  {{ error }}
                </li>
              </ul>
            </div>
          </div>

          <!-- Confirm Password Field -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>{{ "auth.resetPassword.confirmPassword" }}</mat-label>
            <input
              matInput
              formControlName="confirmPassword"
              [type]="hideConfirmPassword ? 'password' : 'text'"
              placeholder="{{ 'auth.resetPassword.reenterPassword' }}"
            />
            <mat-icon matPrefix>lock_clock</mat-icon>
            <button
              mat-icon-button
              matSuffix
              (click)="hideConfirmPassword = !hideConfirmPassword"
              [attr.aria-label]="'auth.common.togglePassword'"
              type="button"
            >
              <mat-icon>{{
                hideConfirmPassword ? "visibility_off" : "visibility"
              }}</mat-icon>
            </button>
            <mat-error *ngIf="resetPasswordForm.hasError('passwordMismatch')">
              {{ "validation.password.mismatch" }}
            </mat-error>
          </mat-form-field>

          <!-- Server Error Message -->
          <div
            class="form-error"
            *ngIf="resetPasswordForm.hasError('serverError')"
            @errorShake
          >
            <mat-icon>error_outline</mat-icon>
            <span>{{ resetPasswordForm.getError("serverError") }}</span>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="resetPasswordForm.invalid || loading"
              class="submit-button"
            >
              <span>{{ "auth.resetPassword.resetButton" }}</span>
              <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
            </button>
            <a mat-button routerLink="/auth/login" class="back-to-login">
              <mat-icon>arrow_back</mat-icon>
              {{ "auth.common.backToLogin" }}
            </a>
          </div>
        </form>

        <!-- Help Section -->
        <div class="help-section" *ngIf="!resetSuccess">
          <mat-divider></mat-divider>
          <div class="help-content">
            <h4>{{ "auth.help.title" }}</h4>
            <p>{{ "auth.help.message" }}</p>
            <div class="contact-info">
              <mat-icon>support_agent</mat-icon>
              <span>{{ "auth.help.support" }}</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
